<link rel="stylesheet" href="css/overview/sxn-overview.v4.min.css" />

<div id="overview">
    <h4>Account Overview</h4>
    <div class="uk-card uk-card-default uk-card-body">

        <!-- Single Col -->

        <div class="app-link uk-grid-match uk-child-width-1-3@m" uk-grid>
            <div>
                <div class="uk-grid-match" uk-grid>
                    <div class="uk-width-1-3@m">
                        <span uk-icon="icon: comments"></span>
                    </div>
                    <div class="uk-width-2-3@m">
                        <p class="count">{{posts}}</p>
                        <p>Total number of posts this week</p>
                        {{#if post_percent}}
                        <b>{{#compare post_percent 0 operator=">"}}+{{/compare}}{{post_percent}}% from last week</b>
                        {{/if}}
                    </div>
                </div>
            </div>
            <div>
                <div class="uk-grid-match" uk-grid>
                    <div class="uk-width-1-3@m">
                        <span uk-icon="icon: calendar"></span>
                    </div>
                    <div class="uk-width-2-3@m">
                        <p class="count">{{events}}</p>
                        <p>Total number of events this week.</p>
                        {{#if event_percent}}
                        <b>{{#compare event_percent 0 operator=">"}}+{{/compare}}{{event_percent}}% from last week</b>
                        {{/if}}
                    </div>
                </div>
            </div>
            <div>
                <div class="uk-grid-match" uk-grid>
                    <div class="uk-width-1-3@m">
                        <span uk-icon="icon: heart"></span>
                    </div>
                    <div class="uk-width-2-3@m">
                        <p class="count">{{follows}}</p>
                        <p>Total number of follows this week.</p>
                        {{#if follow_percent}}
                        <b>{{#compare follow_percent 0 operator=">"}}+{{/compare}}{{follow_percent}}% from last week</b>
                        {{/if}}
                    </div>
                </div>
            </div>
            <div>
                <div class="uk-grid-match" uk-grid>
                    <div class="uk-width-1-3@m">
                        <span uk-icon="icon: users"></span>
                    </div>
                    <div class="uk-width-2-3@m">
                        <p class="count">{{groups}}</p>
                        <p>Total number of groups.</p>
                        {{#if group_percent}}
                        <b>{{#compare group_percent 0 operator=">"}}+{{/compare}}{{group_percent}}% from last week</b>
                        {{/if}}
                    </div>
                </div>
            </div>
            <div>
                <div class="uk-grid-match" uk-grid>
                    <div class="uk-width-1-3@m">
                        <span uk-icon="icon: user"></span>
                    </div>
                    <div class="uk-width-2-3@m">
                        <p class="count">{{users}}</p>
                        <p>Total number of users.</p>
                        {{#if user_percent}}
                        <b>{{#compare user_percent 0 operator=">"}}+{{/compare}}{{user_percent}}% from last week</b>
                        {{/if}}
                    </div>
                </div>
            </div>
            <div>
                <div class="uk-grid-match" uk-grid>
                    <div class="uk-width-1-3@m">
                        <span uk-icon="icon: album"></span>
                    </div>
                    <div class="uk-width-2-3@m">
                        <p class="count">{{subscriptions}}</p>
                        <p>Total number of board subscriptions.</p>
                        {{#if subscriptions_percent}}
                        <b>{{subscriptions_percent}}% from last week</b>
                        {{/if}}
                    </div>
                </div>
            </div>
        </div>

        <!-- Double Col -->

        <div class="app-link double uk-grid-match uk-child-width-1-2@m" uk-grid hidden>
            <div>
                <div class="uk-grid-match" uk-grid>
                    <div class="uk-width-1-3@m">
                        <span uk-icon="icon: user"></span>
                    </div>
                    <div class="uk-width-2-3@m">
                        <p class="count">3,892</p>
                        <p>Lorem ipsum dolor sit amet, sed do eiusmod.</p>
                    </div>
                </div>
            </div>
            <div>
                <div class="uk-grid-match" uk-grid>
                    <div class="uk-width-1-3@m">
                        <span uk-icon="icon: laptop"></span>
                    </div>
                    <div class="uk-width-2-3@m">
                        <p class="count">3,892</p>
                        <p>Lorem ipsum dolor sit amet, sed do eiusmod.</p>
                    </div>
                </div>
            </div>
            <div>
                <div class="uk-grid-match" uk-grid>
                    <div class="uk-width-1-3@m">
                        <span uk-icon="icon: mail"></span>
                    </div>
                    <div class="uk-width-2-3@m">
                        <p class="count">3,892</p>
                        <p>Lorem ipsum dolor sit amet, sed do eiusmod.</p>
                    </div>
                </div>
            </div>
            <div>
                <div class="uk-grid-match" uk-grid>
                    <div class="uk-width-1-3@m">
                        <span uk-icon="icon: users"></span>
                    </div>
                    <div class="uk-width-2-3@m">
                        <p class="count">3,892</p>
                        <p>Lorem ipsum dolor sit amet, sed do eiusmod.</p>
                    </div>
                </div>
            </div>
            <div>
                <div class="uk-grid-match" uk-grid>
                    <div class="uk-width-1-3@m">
                        <span uk-icon="icon: star"></span>
                    </div>
                    <div class="uk-width-2-3@m">
                        <p class="count">3,892</p>
                        <p>Lorem ipsum dolor sit amet, sed do eiusmod.</p>
                    </div>
                </div>
            </div>
            <div>
                <div class="uk-grid-match" uk-grid>
                    <div class="uk-width-1-3@m">
                        <span uk-icon="icon: warning"></span>
                    </div>
                    <div class="uk-width-2-3@m">
                        <p class="count">3,892</p>
                        <p>Lorem ipsum dolor sit amet, sed do eiusmod.</p>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<div id="Reports">
  <h4>Reports</h4>

	<select class="uk-select report-select" id="ReportLevel1">
	  <option value="">Please select</option>
		<option value="students">Students</option>
		<option value="active-users">Active Users</option>
		<option value="inactive-users">Inactive Users</option>
		<option value="jobs">Jobs</option>
		<option value="companies">Companies</option>
		<option value="groups">Groups</option>
		<option value="Events">Events</option>
	</select>

	<select class="uk-select report-select" id="ReportLevel2" disabled></select>

	<select class="uk-select report-select" id="ReportLevel3" disabled></select>

	<button class="uk-button uk-button-primary" id="ReportLevelSubmit" disabled>Get Report</button>

  <canvas id="ReportGraph" width="620"></canvas>
  <div class="chartjs-tooltip" id="tooltip-0"></div>
  <div class="chartjs-tooltip" id="tooltip-1"></div>

  <br /><br /><br />
  <br /><br /><br />
  <br /><br /><br />
  <br /><br /><br />
  <br /><br /><br />
</div>
<script>

	var customTooltips = function (tooltip) {
		$(this._chart.canvas).css("cursor", "pointer");

		var positionY = this._chart.canvas.offsetTop;
		var positionX = this._chart.canvas.offsetLeft;

		$(".chartjs-tooltip").css({
			// opacity: 0,
		});

		if (!tooltip || !tooltip.opacity) {
			return;
		}

		if (tooltip.dataPoints.length > 0) {
			tooltip.dataPoints.forEach(function (dataPoint) {
				var content = [dataPoint.xLabel, dataPoint.yLabel].join(": ");
				var $tooltip = $("#tooltip-" + dataPoint.datasetIndex);

        console.log('id', $tooltip.length);
        console.log('tooltip html', $tooltip.length, dataPoint);
        console.log('--> content', content);
        console.log('x.y', dataPoint.x, dataPoint.y);

				$tooltip.html(content);
				$tooltip.css({
					opacity: 1,
					top: positionY + dataPoint.y + "px",
					left: positionX + dataPoint.x + "px",
				});
			});
		}
	};


  function buildGraph(opts) {
	  var color = Chart.helpers.color;
		var ctx = document.getElementById('ReportGraph').getContext('2d');
		ctx.canvas.style.width = 400;
		// ctx.canvas.style.height = 200;
		var chart = new Chart(ctx, {
			type: 'line',

			data: {
				labels: ["January", "February", "March", "April", "May", "June", "July"],
				datasets:[opts]
				/* datasets: [{
					label: "Number of Events Held by Club",
					backgroundColor: 'rgb(191, 249, 230)',
					borderColor: 'rgb(135, 243, 209)',
					data: [0, 10, 5, 2, 20, 30, 45],
				}] */
			},

			options: {
				responsive: false,
				scales: {
					yAxes: [{
						ticks: {
						  beginAtZero:true
						}
					}]
				},
				tooltips: {
					enabled: false,
					mode: 'index',
					intersect: false,
					custom: customTooltips
				}
			}
		});
  }

  $('#ReportLevel1').change(function() {
	  $.get('/reports/step2', function (data) {
		  var opts = '';

			$.each(data.items, function(key, value) {

			  if (value.items) {
					opts += '<optgroup label="' + value.text + '">';

					$.each(value.items, function (subkey, subvalue) {
					  var defaultSubselected = subvalue.selected ? 'selected' : '';
						opts += '<option value="' + subvalue.value + '" ' + defaultSubselected + '>' + subvalue.text + '</option>';
					});

			    opts += '</optgroup>';
				} else {
				  var defaultSelected = value.selected ? 'selected' : '';

					opts += '<option value="' + value.value + '" ' + defaultSelected + '>' + value.text + '</option>';
				}
			});

      $('#ReportLevel2').append(opts).prop('disabled', false);

    $('#ReportLevelSubmit').prop('disabled', false);;
		});
  });

  $('#ReportLevel2').change(function() {
	  $.get('/reports/step3', function (data) {
		  var opts = '';

			$.each(data.items, function(key, value) {
				opts += '<option value="' + value.value + '">' + value.text + '</option>';
			});

      $('#ReportLevel3').append(opts).prop('disabled', false);;
		});
  });

  /*$('#ReportLevel3').change(function() {
  });*/

  $('#ReportLevelSubmit').click(function() {
    buildGraph({
			label: 'Number of Events Held by Club',
			backgroundColor: 'rgb(191, 249, 230)',
			borderColor: 'rgb(135, 243, 209)',
			data: [0, 10, 5, 2, 20, 30, 45],
		});
  });

	buildGraph({
	  label: 'Please choose report to generate',
		backgroundColor: 'rgb(191, 249, 230)',
		borderColor: 'rgb(135, 243, 209)',
	  data: [],
	});
</script>
