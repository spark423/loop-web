<link rel="stylesheet" href="/css/posts/sxn-posts.v3.min.css" />
<script>
function edit(index) {
  document.getElementById('comment-' + index).style.display = "none";
  document.getElementById('edit-comment-' + index).style.display = "";
}
function saveComment(index, id) {
  var xhttp = new XMLHttpRequest();
  xhttp.open("POST", "/comments/" + id + "/edit", true);
  xhttp.setRequestHeader("Content-Type", "application/json");
  var text = document.getElementById("editedComment-" + index).value;
  xhttp.send(JSON.stringify({text: text}));
  document.getElementById('comment-' + index).style.display = "";
  document.getElementById('comment-' + index).innerHTML = text;
  document.getElementById('edit-comment-' + index).style.display = "none";
}
function cancel(index) {
  document.getElementById('edit-comment-' + index).style.display = "none";
  document.getElementById('comment-' + index).style.display = "";
}
</script>
<div id="posts">

    <h4>Comments</h4>

    <div class="feed-item">
        <div class="uk-card uk-card-default uk-card-body">
          <p style="display: none" id="comment-length-{{@index}}">{{event.comments.length}}</p>
          {{#if event.comments}}
          {{#each event.comments}}
          <form id='delete-comment-{{@index}}' style="display: none" method="post" action="/comments/{{id}}">
          </form>
          {{#compare @index 0 operator="=="}}
          <div class="reply">
              <div class="poster-avi uk-float-left">
                  <img src="/img/user.png" alt="Georgina Reekie" />
              </div>
              <div class="poster-info uk-float-left">
                  <span class="name"><a href='/users/{{postedBy.id}}' style="color: black">{{postedBy.firstName}} {{postedBy.lastName}}</a></span>&nbsp;<span class="timestamp">{{createdAt}}</span><br />
                  <span id="comment-{{@index}}">{{text}}</span>
                  <div class="add-comment" uk-grid id="edit-comment-{{@index}}" style="display: none">
                    <div class="uk-width-expand@m">
                      <input class="uk-input" type="text" name="text" id="editedComment-{{@index}}"value="{{text}}" onkeydown = "if(event.keyCode==13)saveComment({{@index}}, '{{id}}');else if(event.keyCode==27)cancel({{@index}})" autofocus>
                      <p>Press Enter to save, Press ESC to cancel</p>
                    </div>
                  </div>

              </div>
              <div class="more">
                  <div class="uk-inline">
                    <a href="#" class="uk-icon-link" uk-icon="icon: more-vertical"></a>
                    {{>event-comment-menu}}
                  </div>
              </div>
              <div class="uk-clearfix"></div>
          </div>
          {{#if this.comments}}
          <div class="divider"></div>
          <div class="add-comment add-comment-reply" uk-grid>
            <div class="uk-width-expand@m">
              {{#each this.comments}}
              <form id='delete-comment-{{@../index}}-{{@index}}' style="display: none" method="post" action="/comments/{{id}}">
              </form>
              {{#compare @index 0 operator=">"}}
              <div class="divider"></div>
              {{/compare}}
                  <div class="reply">
                      <div class="poster-avi uk-float-left">
                          <img src="/img/user.png" alt="Georgina Reekie" />
                      </div>
                      <div class="poster-info uk-float-left">
                          <span class="name">{{this.postedBy.firstName}} {{this.postedBy.lastName}}</span>&nbsp;<span class="timestamp">{{this.createdAt}}</span><br />
                          <span>{{this.text}}</span>
                      </div>
                      <div class="more">
                          <div class="uk-inline">
                            <a href="#" class="uk-icon-link" uk-icon="icon: more-vertical"></a>
                            <div uk-drop="mode: click">
                                <div class="uk-card uk-card-body uk-card-default">
                                    <ul>
                                        <li>
                                          <a href="#" onclick="document.getElementById('delete-comment-{{@../index}}-{{@index}}').submit();">
                                            Delete Comment
                                          </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                          </div>
                      </div>
                      <div class="uk-clearfix"></div>
                  </div>
              {{/each}}
            </div>
          </div>
          {{/if}}

          <div class="divider reply-{{@index}}" hidden></div>

          <div class="add-comment add-comment-reply reply-{{@index}}" uk-grid hidden>
              <div class="uk-width-expand@m">
                  <form id="comment-{{@../index}}-{{@index}}" method="post" action="/comments/{{id}}/comment">
                      <div>
                          <input class="uk-input" type="text" name="text" placeholder="Add comment...">
                          <a class="uk-button uk-button-default" onclick="document.getElementById('comment-{{@../index}}-{{@index}}').submit();">
                              Comment
                          </a>
                      </div>
                  </form>
              </div>
          </div>

          {{/compare}}
          {{#compare @index 1 operator="=="}}
          <div class="divider"></div>
          <div class="reply">
              <div class="poster-avi uk-float-left">
                  <img src="/img/user.png" alt="Alex Reekie" />
              </div>
              <div class="poster-info uk-float-left">
                <span class="name"><a href='/users/{{postedBy.id}}' style="color: black">{{postedBy.firstName}} {{postedBy.lastName}}</a></span>&nbsp;<span class="timestamp">{{createdAt}}</span><br />
                <span id="comment-{{@index}}">{{text}}</span>
                <div class="add-comment" uk-grid id="edit-comment-{{@index}}" style="display: none">
                  <div class="uk-width-expand@m">
                    <input class="uk-input" type="text" name="text" id="editedComment-{{@index}}"value="{{text}}" onkeydown = "if(event.keyCode==13)saveComment({{@index}}, '{{id}}');else if(event.keyCode==27)cancel({{@index}})" autofocus>
                    <p>Press Enter to save, Press ESC to cancel</p>
                  </div>
                </div>
              </div>
              <div class="more">
                <div class="uk-inline">
                  <a href="#" class="uk-icon-link" uk-icon="icon: more-vertical"></a>
                  {{>event-comment-menu}}
                </div>
              </div>
              <div class="uk-clearfix"></div>
          </div>

          {{#if this.comments}}
          <div class="divider"></div>
          <div class="add-comment add-comment-reply" uk-grid>
            <div class="uk-width-expand@m">
              {{#each this.comments}}
              <form id='delete-comment-{{@../index}}-{{@index}}' style="display: none" method="post" action="/comments/{{id}}">
              </form>
              {{#compare @index 0 operator=">"}}
              <div class="divider"></div>
              {{/compare}}
                  <div class="reply">
                      <div class="poster-avi uk-float-left">
                          <img src="/img/user.png" alt="Georgina Reekie" />
                      </div>
                      <div class="poster-info uk-float-left">
                        <span class="name"><a href='/users/{{postedBy.id}}' style="color: black">{{postedBy.firstName}} {{postedBy.lastName}}</a></span>&nbsp;<span class="timestamp">{{createdAt}}</span><br />
                          <span>{{this.text}}</span>
                      </div>
                      <div class="more">
                          <div class="uk-inline">
                            <a href="#" class="uk-icon-link" uk-icon="icon: more-vertical"></a>
                            <div uk-drop="mode: click">
                                <div class="uk-card uk-card-body uk-card-default">
                                    <ul>
                                        <li>
                                          <a href="#" onclick="document.getElementById('delete-comment-{{@../index}}-{{@index}}').submit();">
                                            Delete Comment
                                          </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>

                          </div>
                      </div>
                      <div class="uk-clearfix"></div>
                  </div>
              {{/each}}
            </div>
          </div>
          {{/if}}

          <div class="divider reply-{{@index}}" hidden></div>

          <div class="add-comment add-comment-reply reply-{{@index}}" uk-grid hidden>
              <div class="uk-width-expand@m">
                <form id="comment-comment-{{@index}}" method="post" action="/comments/{{id}}/comment">
                    <div>
                        <input class="uk-input" type="text" name="text" placeholder="Add comment...">
                        <a class="uk-button uk-button-default" onclick="document.getElementById('comment-comment-{{@index}}').submit();">
                            Comment
                        </a>
                    </div>
                </form>
              </div>
          </div>
          {{#compare ../this.comments.length 2 operator="<="}}
          <div class="divider"></div>
          {{/compare}}
          {{/compare}}

          {{#compare @index 2 operator=">="}}
          {{#compare @index 2 operator="=="}}
          <div class="load-more more-comments-{{this.id}}">
              <a id="more-comments-{{@../index}}" uk-toggle="target: .more-comments-{{this.id}}"></a>
          </div>
          <script>
          document.getElementById('more-comments-{{@../index}}').innerHTML = document.getElementById('comment-length-{{@../index}}').innerHTML - 2 + " more comments";
          </script>

          <div class="more-comments-{{this.id}}" hidden>

              <div class="divider"></div>

              <div class="reply">
                  <div class="poster-avi uk-float-left">
                      <img src="/img/user.png" alt="Georgina Reekie" />
                  </div>
                  <div class="poster-info uk-float-left">
                    <span class="name"><a href='/users/{{postedBy.id}}' style="color: black">{{postedBy.firstName}} {{postedBy.lastName}}</a></span>&nbsp;<span class="timestamp">{{createdAt}}</span><br />
                    <span id="comment-{{@index}}">{{text}}</span>
                    <div class="add-comment" uk-grid id="edit-comment-{{@index}}" style="display: none">
                      <div class="uk-width-expand@m">
                        <input class="uk-input" type="text" name="text" id="editedComment-{{@index}}"value="{{text}}" onkeydown = "if(event.keyCode==13)saveComment({{@index}}, '{{id}}');else if(event.keyCode==27)cancel({{@index}})" autofocus>
                        <p>Press Enter to save, Press ESC to cancel</p>
                      </div>
                    </div>
                  </div>
                  <div class="more">
                    <div class="uk-inline">
                      <a href="#" class="uk-icon-link" uk-icon="icon: more-vertical"></a>
                      {{>event-comment-menu}}
                    </div>
                  </div>
                  <div class="uk-clearfix"></div>
              </div>

              {{#if this.comments}}
              <div class="divider"></div>
              <div class="add-comment add-comment-reply" uk-grid>
                <div class="uk-width-expand@m">
                  {{#each this.comments}}
                  <form id='delete-comment-{{@../index}}-{{@index}}' style="display: none" method="post" action="/comments/{{id}}">
                  </form>
                  {{#compare @index 0 operator=">"}}
                  <div class="divider"></div>
                  {{/compare}}
                      <div class="reply">
                          <div class="poster-avi uk-float-left">
                              <img src="/img/user.png" alt="Georgina Reekie" />
                          </div>
                          <div class="poster-info uk-float-left">
                            <span class="name"><a href='/users/{{postedBy.id}}' style="color: black">{{postedBy.firstName}} {{postedBy.lastName}}</a></span>&nbsp;<span class="timestamp">{{createdAt}}</span><br />
                              <span>{{this.text}}</span>
                          </div>
                          <div class="more">
                              <div class="uk-inline">
                                <a href="#" class="uk-icon-link" uk-icon="icon: more-vertical"></a>
                                <div uk-drop="mode: click">
                                    <div class="uk-card uk-card-body uk-card-default">
                                        <ul>
                                            <li>
                                              <a href="#" onclick="document.getElementById('delete-comment-{{@../index}}-{{@index}}').submit();">
                                                Delete Comment
                                              </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                              </div>
                          </div>
                          <div class="uk-clearfix"></div>
                      </div>
                  {{/each}}
                </div>
              </div>
              {{/if}}

              <div class="divider reply-{{@index}}" hidden></div>

              <div class="add-comment add-comment-reply reply-{{@index}}" uk-grid hidden>
                  <div class="uk-width-expand@m">
                    <form id="comment-comment-{{@index}}" method="post" action="/comments/{{id}}/comment">
                        <div>
                            <input class="uk-input" type="text" name="text" placeholder="Add comment...">
                            <a class="uk-button uk-button-default" onclick="document.getElementById('comment-comment-{{@index}}').submit();">
                                Comment
                            </a>
                        </div>
                    </form>
                  </div>
              </div>

              <div class="divider"></div>

              {{/compare}}
              {{#compare @index 2 operator=">"}}
              <div class="reply">
                  <div class="poster-avi uk-float-left">
                      <img src="/img/user.png" alt="Alex Reekie" />
                  </div>
                  <div class="poster-info uk-float-left">
                    <span class="name"><a href='/users/{{postedBy.id}}' style="color: black">{{postedBy.firstName}} {{postedBy.lastName}}</a></span>&nbsp;<span class="timestamp">{{createdAt}}</span><br />
                    <span id="comment-{{@index}}">{{text}}</span>
                    <div class="add-comment" uk-grid id="edit-comment-{{@index}}" style="display: none">
                      <div class="uk-width-expand@m">
                        <input class="uk-input" type="text" name="text" id="editedComment-{{@index}}"value="{{text}}" onkeydown = "if(event.keyCode==13)saveComment({{@index}}, '{{id}}');else if(event.keyCode==27)cancel({{@index}})" autofocus>
                        <p>Press Enter to save, Press ESC to cancel</p>
                      </div>
                    </div>
                  </div>
                  <div class="more">
                    <div class="uk-inline">
                      <a href="#" class="uk-icon-link" uk-icon="icon: more-vertical"></a>
                      {{>event-comment-menu}}
                    </div>
                  </div>
                  <div class="uk-clearfix"></div>
              </div>

              {{#if this.comments}}
              <div class="divider"></div>
              <div class="add-comment add-comment-reply" uk-grid>
                <div class="uk-width-expand@m">
                  {{#each this.comments}}
                  <form id='delete-comment-{{@../index}}-{{@index}}' style="display: none" method="post" action="/comments/{{id}}">
                  </form>
                  {{#compare @index 0 operator=">"}}
                  <div class="divider"></div>
                  {{/compare}}
                      <div class="reply">
                          <div class="poster-avi uk-float-left">
                              <img src="/img/user.png" alt="Georgina Reekie" />
                          </div>
                          <div class="poster-info uk-float-left">
                            <span class="name"><a href='/users/{{postedBy.id}}' style="color: black">{{postedBy.firstName}} {{postedBy.lastName}}</a></span>&nbsp;<span class="timestamp">{{createdAt}}</span><br />
                              <span>{{this.text}}</span>
                          </div>
                          <div class="more">
                              <div class="uk-inline">
                                <a href="#" class="uk-icon-link" uk-icon="icon: more-vertical"></a>
                                <div uk-drop="mode: click">
                                    <div class="uk-card uk-card-body uk-card-default">
                                        <ul>
                                            <li>
                                              <a href="#" onclick="document.getElementById('delete-comment-{{@../index}}-{{@index}}').submit();">
                                                Delete Comment
                                              </a>
                                            </li>
                                        </ul>
                                    </div>
                                </div>

                              </div>
                          </div>
                          <div class="uk-clearfix"></div>
                      </div>
                  {{/each}}
                </div>
              </div>
              {{/if}}

              <div class="divider reply-{{@index}}" hidden></div>

              <div class="add-comment add-comment-reply reply-{{@index}}" uk-grid hidden>
                  <div class="uk-width-expand@m">
                    <form id="comment-comment-{{@index}}" method="post" action="/comments/{{id}}/comment">
                        <div>
                            <input class="uk-input" type="text" name="text" placeholder="Add comment...">
                            <a class="uk-button uk-button-default" onclick="document.getElementById('comment-comment-{{@index}}').submit();">
                                Comment
                            </a>
                        </div>
                    </form>
                  </div>
              </div>

              <div class="divider"></div>
              {{/compare}}
          {{/compare}}
          {{/each}}
          {{#compare this.comments.length 2 operator=">"}}
        </div>
        {{/compare}}
        {{#compare event.comments.length 2 operator=">"}}
      </div>

        <div class="add-comment" uk-grid>
          <div class="uk-width-expand@m">
              <form id="comment-{{@index}}" method="post" action="/events/{{event.id}}/comment">
                  <div>
                      <input class="uk-input" type="text" name="text" placeholder="Add comment...">
                      <a class="uk-button uk-button-default" onclick="document.getElementById('comment-{{@index}}').submit();">
                          Comment
                      </a>
                  </div>
              </form>
          </div>
      </div>
    </div>
    {{else}}
    <div class="divider"></div>
    <div class="add-comment" uk-grid>
      <div class="uk-width-expand@m">
          <form id="comment-{{@index}}" method="post" action="/events/{{event.id}}/comment">
              <div>
                  <input class="uk-input" type="text" name="text" placeholder="Add comment...">
                  <a class="uk-button uk-button-default" onclick="document.getElementById('comment-{{@index}}').submit();">
                      Comment
                  </a>
              </div>
          </form>
      </div>
    </div>
    </div>
  </div>
    {{/compare}}
        {{else}}

        <div class="add-comment" uk-grid>
          <div class="uk-width-expand@m">
              <form id="comment-{{@index}}" method="post" action="/events/{{event.id}}/comment">
                  <div>
                      <input class="uk-input" type="text" name="text" placeholder="Add comment...">
                      <a class="uk-button uk-button-default" onclick="document.getElementById('comment-{{@index}}').submit();">
                          Comment
                      </a>
                  </div>
              </form>
          </div>
      </div>
    </div>
        {{/if}}

</div>
{{>image-upload-modal}}
